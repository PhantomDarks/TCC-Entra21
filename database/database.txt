
-- TCC ENTRA21 BANCO DE DADOS
drop database TCC;
create database TCC;
use TCC;

create table pessoa(
	id bigint not null primary key auto_increment,
	nome varchar(50) not null,
	sobrenome varchar(50) not null,
	telefone varchar(50) not null,
	cpf char(11) not null,
	login varchar(100) not null,
	senha varchar(50) not null,
	unique(cpf, login)
);

create table empresa(
id bigint not null primary key auto_increment,
razao_social varchar(250),
id_gerente bigint not null,
foreign key (id_gerente) references pessoa(id),
);

create table funcionario(
	id bigint not null primary key auto_increment,
	id_pessoa bigint not null,
	id_supervisor bigint,
	id_empresa bigint not null,
	foreign key (id_pessoa) references pessoa(id),
	foreign key (id_supervisor) references pessoa(id),
	foreign key (id_empresa) references empresa(id)
);

create table carro(
	id bigint not null primary key auto_increment,
	tipo varchar(45) not null,
	id_empresa bigint not null,
 	foreign key (id_empresa) references empresa(id)
);

create table trecho (
id bigint not null primary key auto_increment,
local_inicio varchar(250),
local_fim varchar(250)
);

create table entrega (
id bigint not null primary key auto_increment,
id_entregador bigint not null,
tipo_entrega varchar(45) not null,
foreign key (id_entregador) references funcionario(id)
);

create table entrega_trecho (
id bigint not null primary key auto_increment,
id_entrega bigint not null,
id_trecho bigint not null,
id_carro bigint not null,
completo bit(1),
data_inicio datetime,
data_fim datetime,
foreign key (id_carro) references carro(id),
foreign key (id_entrega) references entrega(id),
foreign key (id_trecho) references trecho(id)
);

create table item(
id bigint not null auto_increment primary key,
localizador varchar(100) not null,
status varchar(50),
local_entrega varchar(300) not null,
nome_recebedor varchar(50) not null,
id_pessoa bigint,
foreign key (id_pessoa) references pessoa(id);
unique(localizador)
);

create table entrega(
id_entrega bigint not null,
id_item bigint not null,
foreign key (id_entrega) references entrega(id),
foreign key (id_item) references item(id),
primary key(id_entrega, id_item)
)

-- disable table
-- create table carro_emrpesa(
-- id_carro bigint not null,
-- id_empresa bigint not null,
-- foreign key (id_carro) references carro(id),
-- foreign key (id_empresa) references emrpesa(id),
-- primary key(id_carro, id_emrpesa)
-- )
